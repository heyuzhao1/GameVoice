# 解决用户加入房间不刷新 UI 的问题

## 问题根源
经过分析，问题出在后端 `RoomManager` 的广播逻辑上。当新用户（Guest）加入房间时，服务器向房间内其他用户（Host）广播的 `user-joined` 事件数据不完整。
- **现状**：广播的数据仅包含 `userId` 和时间戳，缺少客户端渲染所需的完整用户信息（如 `name`）以及用于校验的 `roomId`。
- **后果**：Host 客户端接收到消息后，因为数据缺失或校验失败，无法将新用户添加到 UI 列表，导致看起来只有自己一个人在线。

## 修复方案

### 1. 修改 `src/room-manager.js`
我将更新 `joinRoom` 和 `leaveRoom` 方法中的广播逻辑，确保发送完整的事件数据。

*   **对于 `joinRoom`**：
    *   构建一个包含 `id` 和 `name` 的安全用户对象。
    *   在广播消息中显式包含 `roomId` 和 `user` 对象。
*   **对于 `leaveRoom`**：
    *   在广播消息中显式包含 `roomId`，确保客户端能正确处理用户离开逻辑。

### 2. 验证修复
修复后，无需重新打包客户端（如果是开发模式），只需重启 `npm start` 即可。
*   **Host 端**：应该能实时看到 Guest 加入时的用户卡片和系统通知。
*   **Guest 端**：应该能正常显示房间内的所有用户。

## 执行步骤
1.  修改 `src/room-manager.js` 中的广播代码。
2.  重启应用进行测试。
